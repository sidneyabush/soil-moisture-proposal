source("~/.active-rstudio-document", echo = TRUE)
install.packages("tidyverse")
suppressPackageStartupMessages({
library(tidyverse)
library(janitor)
library(fs)
library(scales)
})
# ---- Paths ----
data_dir <- "/Users/sidneybush/Library/CloudStorage/Box-Box/Sidney_Bush/Soils_Proposal/data"
out_dir  <- "/Users/sidneybush/Library/CloudStorage/Box-Box/Sidney_Bush/Soils_Proposal/outputs"
dir_create(out_dir, recurse = TRUE)
# ---- Quick directory printout (helps confirm structure) ----
cat("\n=== Data directory tree (2 levels) ===\n")
print(fs::dir_tree(data_dir, recurse = 2))
# ---- Input files ----
climate_path <- file.path(data_dir, "AI4PF_climate.csv")
landuse_path <- file.path(data_dir, "GLC_Annual_AI4PF.csv")
if (!file.exists(climate_path)) stop("Missing file: ", climate_path)
if (!file.exists(landuse_path)) stop("Missing file: ", landuse_path)
landuse_path <- file.path(data_dir, "GLC_Annual_AI4PF.csv")
# ---- Read data ----
climate_raw <- readr::read_csv(climate_path, show_col_types = FALSE) %>% clean_names()
landuse_raw <- readr::read_csv(landuse_path, show_col_types = FALSE) %>% clean_names()
View(climate_raw)
View(landuse_raw)
# ---- Standardize key fields ----
# Climate file has: plot_id_fullname, climate_z, name
climate <- climate_raw %>%
transmute(
plot_id = plot_id_fullname,
climate_z = climate_z,
climate_name = name
) %>%
filter(!is.na(plot_id)) %>%
distinct()
# Landuse file has: plot_id_fu, year, land_class, area_m2 (also pix_count)
landuse <- landuse_raw %>%
transmute(
plot_id = plot_id_fu,
year = as.integer(year),
land_class = as.character(land_class),
area_m2 = as.numeric(area_m2)
) %>%
filter(!is.na(plot_id), !is.na(year), year >= 2000, year <= 2022)
View(landuse)
View(climate)
# Landuse file has: plot_id_fu, year, land_class, area_m2 (also pix_count)
landuse <- landuse_raw %>%
transmute(
plot_id = plot_id_fu,
year = as.integer(year),
land_class = as.character(land_class),
area_m2 = as.numeric(area_m2)
) %>%
filter(!is.na(plot_id), !is.na(year), year >= 2000, year <= 2022)
# ---- Join + compute within-plot yearly proportions ----
# prop = area_m2 / total_area_m2 per plot-year
lu <- landuse %>%
inner_join(climate, by = "plot_id") %>%
group_by(plot_id, year) %>%
mutate(
total_area_m2 = sum(area_m2, na.rm = TRUE),
prop = ifelse(total_area_m2 > 0, area_m2 / total_area_m2, NA_real_)
) %>%
ungroup()
# ---- Join + compute within-plot yearly proportions ----
# prop = area_m2 / total_area_m2 per plot-year
lu <- landuse %>%
inner_join(climate, by = "plot_id") %>%
group_by(plot_id, year) %>%
mutate(
total_area_m2 = sum(area_m2, na.rm = TRUE),
prop = ifelse(total_area_m2 > 0, area_m2 / total_area_m2, NA_real_)
) %>%
ungroup()
# ---- Choose featured land classes (top by mean proportion) ----
top_classes <- lu %>%
group_by(land_class) %>%
summarise(mean_prop = mean(prop, na.rm = TRUE), .groups = "drop") %>%
arrange(desc(mean_prop)) %>%
slice_head(n = 6) %>%
pull(land_class)
lu_top <- lu %>% filter(land_class %in% top_classes)
# ---- Helper: save plot ----
save_plot <- function(p, fname, w = 9, h = 6, dpi = 300) {
out_path <- file.path(out_dir, fname)
ggsave(filename = out_path, plot = p, width = w, height = h, dpi = dpi)
cat("Saved:", out_path, "\n")
}
# ============================================================
# FIG 1 — Site coverage across climate zones (context only)
# ============================================================
fig1 <- lu %>%
distinct(plot_id, climate_z, climate_name) %>%
count(climate_z, climate_name, name = "n_sites") %>%
mutate(
climate_lab = paste0(climate_z, " – ", climate_name),
climate_lab = fct_reorder(climate_lab, n_sites)
) %>%
ggplot(aes(x = n_sites, y = climate_lab)) +
geom_col() +
labs(
title = "Site coverage across climate zones",
subtitle = "Context only (not a variability plot): counts of sites by climate zone",
x = "Number of sites",
y = NULL
) +
theme_minimal(base_size = 12)
save_plot(fig1, "fig01_sites_by_climate.png", w = 9, h = 7)
# ============================================================
# FIG 2 — Across-site variability in land-use composition by climate
# Uses site-level MEAN proportion across 2000–2022
# (violin shows spread; points show sites)
# ============================================================
site_means <- lu_top %>%
group_by(plot_id, climate_z, climate_name, land_class) %>%
summarise(mean_prop_2000_2022 = mean(prop, na.rm = TRUE), .groups = "drop") %>%
mutate(climate_lab = paste0(climate_z, " – ", climate_name))
fig2 <- site_means %>%
ggplot(aes(x = climate_lab, y = mean_prop_2000_2022)) +
geom_violin(trim = TRUE) +
geom_point(position = position_jitter(width = 0.15), alpha = 0.25, size = 1) +
scale_y_continuous(labels = percent_format(accuracy = 1)) +
facet_wrap(~ land_class, scales = "free_y", ncol = 2) +
labs(
title = "Across-site variability in land-use composition (mean 2000–2022)",
x = "Climate zone",
y = "Mean proportion of plot area"
) +
theme_minimal(base_size = 12) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
save_plot(fig2, "fig02_violin_landuse_by_climate.png", w = 11, h = 8)
# ============================================================
# FIG 3 — Variability over time: mean + IQR ribbon across sites
# For each climate zone and featured land class
# ============================================================
ts_summary <- lu_top %>%
group_by(climate_z, climate_name, land_class, year) %>%
summarise(
mean_prop = mean(prop, na.rm = TRUE),
q25 = quantile(prop, 0.25, na.rm = TRUE),
q75 = quantile(prop, 0.75, na.rm = TRUE),
n_sites = n_distinct(plot_id),
.groups = "drop"
) %>%
mutate(climate_lab = paste0(climate_z, " – ", climate_name))
fig3 <- ts_summary %>%
ggplot(aes(x = year, y = mean_prop)) +
geom_ribbon(aes(ymin = q25, ymax = q75), alpha = 0.25) +
geom_line() +
scale_y_continuous(labels = percent_format(accuracy = 1)) +
facet_grid(land_class ~ climate_lab, scales = "free_y") +
labs(
title = "Land-use change (2000–2022): mean trend with across-site variability (IQR)",
subtitle = "Ribbon = interquartile range across sites within each climate zone",
x = NULL,
y = "Proportion of plot area"
) +
theme_minimal(base_size = 11)
save_plot(fig3, "fig03_timeseries_iqr_by_climate.png", w = 14, h = 10)
# ============================================================
# FIG 4 — “How mixed are sites?” Shannon diversity by climate
# Computed per plot-year across ALL land classes (not just top 6),
# then averaged per plot across 2000–2022
# ============================================================
shannon <- lu %>%
group_by(plot_id, climate_z, climate_name, year) %>%
summarise(
H = -sum(ifelse(prop > 0, prop * log(prop), 0), na.rm = TRUE),
.groups = "drop"
) %>%
mutate(climate_lab = paste0(climate_z, " – ", climate_name))
fig4 <- shannon %>%
group_by(plot_id, climate_lab) %>%
summarise(H_mean = mean(H, na.rm = TRUE), .groups = "drop") %>%
ggplot(aes(x = climate_lab, y = H_mean)) +
geom_boxplot(outlier.alpha = 0.2) +
geom_point(position = position_jitter(width = 0.15), alpha = 0.25, size = 1) +
labs(
title = "Variability in land-use mixture (Shannon diversity), averaged across 2000–2022",
x = "Climate zone",
y = "Shannon diversity (higher = more mixed)"
) +
theme_minimal(base_size = 12) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
save_plot(fig4, "fig04_shannon_diversity_by_climate.png", w = 11, h = 7)
# ============================================================
# FIG 5 — (Variance-first) Site-level temporal variability by climate
# For each plot and land class: SD and CV of prop over time (2000–2022)
# Then show distributions by climate zone (violin + points)
# ============================================================
site_var <- lu_top %>%
group_by(plot_id, climate_z, climate_name, land_class) %>%
summarise(
mean_prop = mean(prop, na.rm = TRUE),
sd_prop   = sd(prop, na.rm = TRUE),
cv_prop   = ifelse(mean_prop > 0, sd_prop / mean_prop, NA_real_),
n_years   = sum(!is.na(prop)),
.groups = "drop"
) %>%
mutate(climate_lab = paste0(climate_z, " – ", climate_name))
# SD plot (absolute variability)
fig5a <- site_var %>%
ggplot(aes(x = climate_lab, y = sd_prop)) +
geom_violin(trim = TRUE) +
geom_point(position = position_jitter(width = 0.15), alpha = 0.25, size = 1) +
facet_wrap(~ land_class, scales = "free_y", ncol = 2) +
labs(
title = "Site-level temporal variability in land-use (SD of yearly proportion, 2000–2022)",
subtitle = "Each point is one site; violin shows distribution within climate zone",
x = "Climate zone",
y = "SD of yearly proportion"
) +
theme_minimal(base_size = 12) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
save_plot(fig5a, "fig05a_site_temporal_sd_by_climate.png", w = 11, h = 8)
# CV plot (relative variability; can be more comparable across classes)
fig5b <- site_var %>%
ggplot(aes(x = climate_lab, y = cv_prop)) +
geom_violin(trim = TRUE) +
geom_point(position = position_jitter(width = 0.15), alpha = 0.25, size = 1) +
facet_wrap(~ land_class, scales = "free_y", ncol = 2) +
labs(
title = "Site-level temporal variability in land-use (CV of yearly proportion, 2000–2022)",
subtitle = "CV = SD / mean; highlights relative volatility",
x = "Climate zone",
y = "Coefficient of variation (CV)"
) +
theme_minimal(base_size = 12) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
save_plot(fig5b, "fig05b_site_temporal_cv_by_climate.png", w = 11, h = 8)
source("~/Documents/GitHub/soil-moisture-proposal/prelim_plots.R", echo = TRUE)
source("~/Documents/GitHub/soil-moisture-proposal/prelim_plots.R", echo = TRUE)
source("~/Documents/GitHub/soil-moisture-proposal/prelim_plots.R", echo = TRUE)
source("~/Documents/GitHub/soil-moisture-proposal/prelim_plots.R", echo = TRUE)
source("~/Documents/GitHub/soil-moisture-proposal/prelim_plots.R", echo = TRUE)
source("~/Documents/GitHub/soil-moisture-proposal/prelim_plots.R", echo = TRUE)
View(climate_raw)
View(landuse_raw)
View(site_var)
View(landuse)
View(lu)
View(climate_raw)
View(climate_raw)
View(landuse_raw)
suppressPackageStartupMessages({
library(tidyverse)
library(janitor)
library(fs)
library(scales)
})
# ---- Paths ----
data_dir <- "/Users/sidneybush/Library/CloudStorage/Box-Box/Sidney_Bush/Soils_Proposal/data"
out_dir  <- "/Users/sidneybush/Library/CloudStorage/Box-Box/Sidney_Bush/Soils_Proposal/outputs"
dir_create(out_dir, recurse = TRUE)
# ---- Input files ----
climate_path <- file.path(data_dir, "AI4PF_climate.csv")
landuse_path <- file.path(data_dir, "GLC_Annual_AI4PF.csv")
if (!file.exists(climate_path)) stop("Missing file: ", climate_path)
if (!file.exists(landuse_path)) stop("Missing file: ", landuse_path)
landuse_path <- file.path(data_dir, "GLC_Annual_AI4PF.csv")
# ---- Read data ----
climate_raw <- readr::read_csv(climate_path, show_col_types = FALSE) %>% clean_names()
landuse_raw <- readr::read_csv(landuse_path, show_col_types = FALSE) %>% clean_names()
View(landuse_raw)
# ---- Read data ----
climate_raw <- readr::read_csv(climate_path, show_col_types = FALSE)
View(climate_raw)
# ---- Read data ----
climate_raw <- readr::read_csv(climate_path, show_col_types = FALSE)
View(climate_raw)
# ============================================================
# Variability figures
#
# Reads from:
#   /Users/sidneybush/Library/CloudStorage/Box-Box/Sidney_Bush/Soils_Proposal/data
#
# Saves to:
#   /Users/sidneybush/Library/CloudStorage/Box-Box/Sidney_Bush/Soils_Proposal/outputs
# ============================================================
suppressPackageStartupMessages({
library(tidyverse)
library(janitor)
library(fs)
library(scales)
})
# ---- Paths ----
data_dir <- "/Users/sidneybush/Library/CloudStorage/Box-Box/Sidney_Bush/Soils_Proposal/data"
out_dir  <- "/Users/sidneybush/Library/CloudStorage/Box-Box/Sidney_Bush/Soils_Proposal/outputs"
dir_create(out_dir, recurse = TRUE)
# ---- Input files ----
climate_path <- file.path(data_dir, "AI4PF_climate.csv")
landuse_path <- file.path(data_dir, "GLC_Annual_AI4PF.csv")
# ---- Read data ----
climate_raw <- readr::read_csv(climate_path, show_col_types = FALSE) %>% clean_names()
landuse_raw <- readr::read_csv(landuse_path, show_col_types = FALSE) %>% clean_names()
# ---- Standardize key fields ----
# Climate file has: plot_id_fullname, name
climate <- climate_raw %>%
transmute(
plot_id = plot_id_fullname,
climate_name = name
) %>%
filter(!is.na(plot_id), !is.na(climate_name)) %>%
distinct()
# Landuse file has: plot_id_fu, year, land_class, area_m2 (also pix_count)
landuse <- landuse_raw %>%
transmute(
plot_id = plot_id_fu,
year = as.integer(year),
land_class = as.character(land_class),
area_m2 = as.numeric(area_m2)
) %>%
filter(!is.na(plot_id), !is.na(year), year >= 2000, year <= 2022)
# ---- Join + compute within-plot yearly proportions ----
# prop = area_m2 / total_area_m2 per plot-year
lu <- landuse %>%
inner_join(climate, by = "plot_id") %>%
group_by(plot_id, year) %>%
mutate(
total_area_m2 = sum(area_m2, na.rm = TRUE),
prop = ifelse(total_area_m2 > 0, area_m2 / total_area_m2, NA_real_)
) %>%
ungroup() %>%
filter(is.finite(prop), prop >= 0, prop <= 1)
# ---- Helper: save plot ----
save_plot <- function(p, fname, w = 9, h = 6, dpi = 300) {
out_path <- file.path(out_dir, fname)
ggsave(filename = out_path, plot = p, width = w, height = h, dpi = dpi)
cat("Saved:", out_path, "\n")
}
View(climate)
unique(climate$climate_name)
View(climate_raw)
View(landuse_raw)
source("~/Documents/GitHub/soil-moisture-proposal/prelim_plots.R", echo = TRUE)
source("~/Documents/GitHub/soil-moisture-proposal/prelim_plots.R", echo = TRUE)
source("~/Documents/GitHub/soil-moisture-proposal/prelim_plots.R", echo = TRUE)
source("~/Documents/GitHub/soil-moisture-proposal/prelim_plots.R", echo = TRUE)
source("~/Documents/GitHub/soil-moisture-proposal/prelim_plots.R", echo = TRUE)
source("~/Documents/GitHub/soil-moisture-proposal/prelim_plots.R", echo = TRUE)
source("~/Documents/GitHub/soil-moisture-proposal/prelim_plots.R", echo = TRUE)
source("~/Documents/GitHub/soil-moisture-proposal/prelim_plots.R", echo = TRUE)
source("~/Documents/GitHub/soil-moisture-proposal/prelim_plots.R", echo = TRUE)
source("~/Documents/GitHub/soil-moisture-proposal/prelim_plots.R", echo = TRUE)
source("~/Documents/GitHub/soil-moisture-proposal/prelim_plots.R", echo = TRUE)
source("~/Documents/GitHub/soil-moisture-proposal/prelim_plots.R", echo = TRUE)
source("~/Documents/GitHub/soil-moisture-proposal/prelim_plots.R", echo = TRUE)
unique(landuse$land_class)
unique(lu$land_class)
source("~/Documents/GitHub/soil-moisture-proposal/prelim_plots.R", echo = TRUE)
source("~/Documents/GitHub/soil-moisture-proposal/prelim_plots.R", echo = TRUE)
source("~/Documents/GitHub/soil-moisture-proposal/prelim_plots.R", echo = TRUE)
source("~/Documents/GitHub/soil-moisture-proposal/prelim_plots.R", echo = TRUE)
source("~/Documents/GitHub/soil-moisture-proposal/prelim_plots.R", echo = TRUE)
source("~/Documents/GitHub/soil-moisture-proposal/prelim_plots.R", echo = TRUE)
source("~/Documents/GitHub/soil-moisture-proposal/prelim_plots.R", echo = TRUE)
